---
title: Chapter 5. Scope Closure
tags: [closure]
sidebar_position: 5
---

<br/>

## 들어가며 🏃

---

스코프가 작동하는 방식에 대해 자세히 알아봤습니다. 이제 클로저에 대해 알아봅시다.

<br/>

## Enlightenment

---

자바스크립트에서 클로저를 이해하는 것은 열반에 이르는 것처럼 보일 수 있습니다.

- 클로저는 새로운 구문과 패턴을 배워야 하는 새로운 도구가 아닙니다.
- 클로저는 정적 스코프에 의존하는 코드를 작성한 결과로 발생합니다.
  - 그렇기에 클로저 활용을 위해 클로저를 만들 필요가 없습니다.

<br/>

## Nitty Gritty

---

**클로저(Closure)**는 함수가 정적 스코프 밖에서 실행될 때에도 **함수가 정적 스코프를 기억하고 접근할 수 있는 것**을 의미합니다.

```js
function foo() {
  var a = 2;

  function bar() {
    console.log(a); // 2
  }
  bar();
}

foo();
```

함수 `bar()` 는 정적 스코프 조회 규칙(이 경우 RHS)에 따라 바깥쪽 범위의 변수 `a` 에 접근할 수 있습니다.

> 이것이 **클로저인가요?**

- 아마도 그럴 것이지만, 정확하진 않습니다.
- `a` 를 참조하는 `bar()` 를 설명하는 가장 정확한 방법은 정적 스코프 조회 규칙을 사용하는 것이며 이 규칙은 클로저의 일부일 뿐입니다.

학문적인 관점에서 위 코드는 **함수 `bar()` 가 `foo()` 의 스코프에 대해 클로저를 갖고 있다는 것**입니다.

- 다른 말로 `bar()` 가 `foo()` 의 스코프를 닫는다고 말하며, 이는 `bar()` 가 `foo()` 내부에 중첩되기 때문입니다.

클로저는 직접 확인할 수 있는 정적 스코프와 달리 코드 이면에서 일종의 신비한 이동 그림자로 남아있습니다.

```js
function foo() {
  var a = 2;

  function bar() {
    console.log(a);
  }

  return bar;
}

var baz = foo();

baz(); // 2 -- Whoa, closure was just observed, man.
```

함수 `bar()` 는 `foo()` 의 내부 스코프에 대한 정적 스코프 접근 권한을 갖습니다.

- 하지만 **함수 자체인 `bar()` 를 가져와 값으로 전달**합니다.
  - 이 경우 `bar` 가 참조하는 함수 객체 자체를 반환합니다.
  - `foo()` 실행 후 반환 값(함수 `bar()`)을 `baz` 에 전달한 뒤 `baz()` 호출

함수 `bar()` 는 분명히 실행되지만, 이 경우 정적 스코프 밖에서 실행됩니다.

- 원래는 `foo()` 가 실행된 후, 일반적으로 `foo()` 의 내부 스코프 전체가 사라질 것으로 예상됩니다.
  - 이는 가비지 콜렉터가 엔진이 더 이상 사용하지 않는 메모리를 해제한다는 것을 알기 때문입니다.

그러나 클로저는 이를 가능하게 하며 함수 `bar()` 가 이를 사용하고 있다고 판단합니다.

- `bar()` 에는 여전히 `foo()` 내부 스코프에 대한 참조를 가지며 해당 참조를 클로저라고 하는 것입니다.

결국 클로저를 통해 작성자 시점에 정의된 정적 스코프에 계속 접근할 수 있고, 함수가 값으로 전달되고 호출될 수 있는 다양한 방법은 모두 클로저를 확인/실행하는 예시입니다.

```js
function foo() {
  var a = 2;

  function baz() {
    console.log(a); // 2
  }

  bar(baz);
}

function bar(fn) {
  fn(); // look ma, I saw closure!
}
```

내부 함수 `baz` 를 `bar` 로 전달하고 내부 함수(지금은 `fn` 으로 레이블 지정)를 호출합니다.

- 그렇게 할 때, `foo()` 내부 범위에 대한 클로저는 `a` 에 접근하여 확인할 수 있습니다.

```js
var fn;

function foo() {
  var a = 2;

  function baz() {
    console.log(a);
  }

  fn = baz; // assign baz to global variable
}

function bar() {
  fn(); // look ma, I saw closure!
}

foo();

bar(); // 2
```

내부 함수를 정적 스코프 외부로 전달하기 위해선 사용하는 함수가 무엇이든 간에, 원래 선언된 위치에 대한 스코프 참조를 유지하고 우리가 이를 실행할 때마다 클로저가 실행됩니다.
